# =============================================================================
# SysArmor EDR 极简环境配置 - 12-Factor App模式
# 按服务逻辑分类，只设置核心HOST和端口，其他配置自动派生
# =============================================================================

# 部署模式
# 可选值：single-node, distributed
DEPLOYMENT_MODE=single-node
# 可选值：development, production
ENVIRONMENT=development

# =============================================================================
# Manager服务配置 (控制平面)
# =============================================================================
MANAGER_HOST=localhost
MANAGER_PORT=8080

# 数据库配置
POSTGRES_DB=sysarmor
POSTGRES_USER=sysarmor
POSTGRES_PASSWORD=password

# =============================================================================
# Middleware服务配置 (数据中间件)
# =============================================================================
# 分布式部署时设置为远程IP
MIDDLEWARE_HOST=localhost

# 细粒度服务主机配置 (容器内部访问)
# Kafka容器名称，分布式时设为远程IP
KAFKA_HOST=middleware-kafka
# Vector容器名称，分布式时设为远程IP (用于容器内部通信和健康检查)
VECTOR_HOST=middleware-vector
# Vector外部访问地址 (用于客户端连接和收集器安装)
EXTERNAL_VECTOR_HOST=localhost
# Prometheus容器名称，分布式时设为远程IP
PROMETHEUS_HOST=middleware-prometheus

# 核心端口
VECTOR_TCP_PORT=6000
VECTOR_API_PORT=8686
VECTOR_METRICS_PORT=9598
# 外部访问端口，避免与内部9092冲突
KAFKA_PORT=9094
PROMETHEUS_PORT=9090

# =============================================================================
# Processor服务配置 (数据处理)
# =============================================================================
# 分布式部署时可设为容器名或远程IP
PROCESSOR_HOST=localhost

# 细粒度服务主机配置 (容器内部访问)
# Flink JobManager容器名称
FLINK_JOBMANAGER_HOST=flink-jobmanager
# Flink TaskManager容器名称
FLINK_TASKMANAGER_HOST=flink-taskmanager

FLINK_PORT=8081

# =============================================================================
# Indexer服务配置 (索引存储)
# =============================================================================
# 分布式部署时可设为容器名或远程IP
INDEXER_HOST=localhost

# 细粒度服务主机配置 (容器内部访问)
# OpenSearch容器名称
OPENSEARCH_HOST=opensearch
# Indexer服务容器名称
INDEXER_SERVICE_HOST=indexer-service

OPENSEARCH_PORT=9200

# OpenSearch认证
OPENSEARCH_USERNAME=admin
OPENSEARCH_PASSWORD=admin
INDEX_PREFIX=sysarmor-events

# =============================================================================
# 网络和Volume配置 (基础设施)
# =============================================================================
SYSARMOR_NETWORK=sysarmor-net
SYSARMOR_NETWORK_EXTERNAL=false

# =============================================================================
# Wazuh集成配置 (可选功能)
# =============================================================================
WAZUH_ENABLED=false
WAZUH_MANAGER_HOST=wazuh-manager
WAZUH_MANAGER_PORT=55000
WAZUH_MANAGER_USERNAME=wazuh
WAZUH_MANAGER_PASSWORD=wazuh
WAZUH_INDEXER_HOST=wazuh-indexer
WAZUH_INDEXER_PORT=9200
WAZUH_INDEXER_USERNAME=admin
WAZUH_INDEXER_PASSWORD=admin

# =============================================================================
# 配置说明 - 双层HOST配置架构
# =============================================================================
# 
# 🏗️ 配置架构说明:
# 1. 逻辑服务HOST: 用于外部访问和端口映射 (MIDDLEWARE_HOST, PROCESSOR_HOST, INDEXER_HOST)
# 2. 细粒度容器HOST: 用于容器内部服务间通信 (KAFKA_HOST, VECTOR_HOST, 等)
# 3. 外部访问HOST: 用于客户端连接和收集器安装 (EXTERNAL_VECTOR_HOST)
#
# 📋 Manager服务自动派生的连接配置:
# KAFKA_BOOTSTRAP_SERVERS=${KAFKA_HOST}:9092 (容器内部访问)
# PROMETHEUS_URL=http://${PROMETHEUS_HOST}:9090
# OPENSEARCH_URL=http://${OPENSEARCH_HOST}:${OPENSEARCH_PORT}
# FLINK_JOBMANAGER_URL=http://${FLINK_JOBMANAGER_HOST}:${FLINK_PORT}
# WORKER_URLS=${VECTOR_HOST}:http://${VECTOR_HOST}:${VECTOR_TCP_PORT}:http://${VECTOR_HOST}:8686/health
#
# 📋 Processor服务自动派生的连接配置:
# KAFKA_BOOTSTRAP_SERVERS=${KAFKA_HOST}:9092
# OPENSEARCH_URL=http://${OPENSEARCH_HOST}:${OPENSEARCH_PORT}
#
# 🚀 部署模式配置示例:
#
# All-in-one模式 (.env):
# MIDDLEWARE_HOST=localhost (外部访问)
# KAFKA_HOST=middleware-kafka (容器内部)
# VECTOR_HOST=middleware-vector (容器内部通信)
# EXTERNAL_VECTOR_HOST=localhost (外部客户端访问)
# PROMETHEUS_HOST=middleware-prometheus
# PROCESSOR_HOST=localhost
# FLINK_JOBMANAGER_HOST=flink-jobmanager
# INDEXER_HOST=localhost
# OPENSEARCH_HOST=opensearch
#
# Distributed模式 (.env.dev):
# MIDDLEWARE_HOST=49.232.13.155 (远程服务器)
# KAFKA_HOST=49.232.13.155 (远程IP)
# VECTOR_HOST=49.232.13.155 (远程内部通信)
# EXTERNAL_VECTOR_HOST=49.232.13.155 (远程客户端访问)
# PROMETHEUS_HOST=49.232.13.155
# PROCESSOR_HOST=localhost (本地服务)
# FLINK_JOBMANAGER_HOST=flink-jobmanager (本地容器)
# INDEXER_HOST=localhost
# OPENSEARCH_HOST=opensearch (本地容器)
#
# 💡 配置优势:
# - 同一套配置支持多种部署拓扑
# - 容器内部和外部访问分离
# - 服务可以灵活部署在不同主机上
# - 保持配置的简洁性和可维护性
