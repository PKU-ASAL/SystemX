# SysArmor EDR/HIDS v0.1 版本功能特性

## 🎯 版本概述

SysArmor v0.1 是首个发布版本，提供完整的端点检测与响应(EDR/HIDS)解决方案，支持agentless数据采集、实时威胁分析和智能预警。

**发布日期**: 2025年Q1  
**架构**: 控制平面 + 数据平面分离  
**部署方式**: Docker Compose 一键部署  

### 🎯 核心任务
1. **🔄 代码合并整理** - Monorepo已创建，待合并
2. **✅ SysArmor前端页面实现** - 已完成
3. **🔄 前后端接口打通** - 进行中
4. **🔄 Auditd→Sysdig格式转换集成** - 已验证原型，待实现
5. **📋 NODLINK/KnowHow服务化接入** - v0.2版本
6. **📋 Agent模式支持** - v0.2版本
7. **📋 Wazuh模式支持** - v0.2版本

### 分工
1. **🔄 代码合并整理** : 建栋
2. **✅ SysArmor前端页面实现** : 建栋, 霄汉
3. **🔄 SysArmor前后端接口打通**: 建栋
4. **🔄 Auditd→Sysdig格式转换集成**: 棋耀
5. **📋 NODLINK/KnowHow服务化接入**: 黄艺、榆涵、少飞
6. **📋 Agent模式支持**: 黄正、赵淼
7. **📋 Wazuh模式支持**: 峰伟

---

## 🏗️ 核心架构

### 四大核心模块
- **Manager**: 控制平面，系统管理和配置 (Go + PostgreSQL)
- **Middleware**: 数据中间件，消息队列和路由 (Vector + Kafka)
- **Processor**: 数据处理，实时威胁检测 (Flink + PyFlink)
- **Indexer**: 索引存储，搜索和查询 (OpenSearch + Python)

### 技术栈
- **后端**: Go 1.24, Python 3.11
- **流处理**: Apache Flink 1.18
- **消息队列**: Apache Kafka (KRaft模式)
- **搜索引擎**: OpenSearch 2.11
- **数据收集**: Vector (Rust)
- **数据库**: PostgreSQL 15
- **监控**: Prometheus + JMX Exporter
- **容器化**: Docker + Docker Compose

---

## ✨ 核心功能特性

### 1. 🔧 系统管理 (Manager模块)

#### 设备管理
- ✅ **设备注册**: 支持Linux设备的自动注册和管理
- ✅ **脚本生成**: 自动生成agentless安装/卸载脚本
- ✅ **设备监控**: 实时监控设备状态和健康度
- ✅ **元数据管理**: 设备标签、分组、环境标识

#### API服务
- ✅ **RESTful API**: 完整的REST API接口
- ✅ **Swagger文档**: 自动生成的API文档
- ✅ **健康检查**: 系统和组件健康状态监控
- ✅ **配置管理**: 12-Factor App配置模式

### 2. 📡 数据采集 (Middleware模块)

#### Agentless采集
- ✅ **Rsyslog集成**: 基于rsyslog的无代理数据采集
- ✅ **Auditd支持**: Linux auditd审计日志采集
- ✅ **动态路由**: 基于collector_id的动态Topic路由
- ✅ **数据预处理**: JSON格式化和字段标准化

#### 消息队列
- ✅ **Kafka集群**: KRaft模式的高可用Kafka
- ✅ **Topic管理**: 自动创建和管理Topic
- ✅ **性能优化**: 批处理、压缩、持久化配置
- ✅ **监控指标**: JMX指标导出和Prometheus集成

### 3. 🛡️ 威胁检测 (Processor模块)

#### 实时流处理
- ✅ **Flink引擎**: 基于Apache Flink的实时流处理
- ✅ **DataStream API**: 高性能的流数据处理
- ✅ **状态管理**: 有状态的威胁检测和关联分析
- ✅ **容错机制**: Checkpoint和故障恢复

#### 数据格式转换 (v0.1新增)
- ✅ **Auditd解析**: 完整的auditd日志解析器
- ✅ **Sysdig转换**: 实时auditd到sysdig格式转换
- ✅ **进程树重建**: 基于时间窗口的父进程命令行重建
- ✅ **命令行解码**: 十六进制命令行自动解码
- ✅ **动态Topic**: 自动生成对应的sysdig格式Topic
- ✅ **NODLINK兼容**: 支持22种NODLINK标准事件类型

#### 威胁检测规则
- ✅ **权限提升检测**: sudo、setuid/setgid系统调用监控
- ✅ **可疑活动检测**: 临时目录程序执行、异常行为
- ✅ **敏感文件访问**: /etc/passwd、/etc/shadow等关键文件
- ✅ **系统完整性**: 系统二进制文件修改监控
- ✅ **网络活动**: 可疑网络连接、反向shell检测
- ✅ **命令注入**: 危险命令执行检测
- ✅ **文件操作**: 危险删除操作、权限修改
- ✅ **网络扫描**: nmap等扫描工具检测

### 4. 🔍 数据存储与查询 (Indexer模块)

#### 数据索引
- ✅ **OpenSearch集成**: 高性能的搜索和分析引擎
- ✅ **威胁事件存储**: 结构化威胁事件索引
- ✅ **时间序列**: 基于时间的事件存储和查询
- ✅ **全文搜索**: 支持复杂查询和聚合分析

#### 查询服务
- ✅ **REST API**: 丰富的查询API接口
- ✅ **时间范围查询**: 按时间段查询威胁事件
- ✅ **风险等级过滤**: 按风险评分和严重程度过滤
- ✅ **数据源查询**: 按collector_id查询特定设备事件

---

## 🚀 部署与运维

### 一键部署
- ✅ **Docker Compose**: 统一的服务编排
- ✅ **环境配置**: .env文件驱动的配置管理
- ✅ **自动初始化**: 数据库自动迁移和初始化
- ✅ **健康检查**: 所有服务的健康状态监控

### 监控运维
- ✅ **Prometheus集成**: 完整的指标收集
- ✅ **JMX监控**: Kafka JMX指标导出
- ✅ **日志管理**: 统一的日志收集和查看
- ✅ **Web界面**: 各组件的Web管理界面

### 管理工具
- ✅ **Makefile**: 统一的构建和管理命令
- ✅ **脚本工具**: 安装、卸载、测试脚本
- ✅ **API工具**: 完整的API管理接口

---

## 🔄 v0.1 开发状态

### ✅ 已完成功能

#### 1. 代码合并整理
- **Monorepo架构**: 四大模块统一管理
- **Docker编排**: 服务编排
- **配置统一**: 所有模块配置通过环境变量统一
- **构建系统**: 简单的Makefile构建流程

#### 2. SysArmor前端页面实现
- **Web管理界面**: 完整的前端管理页面
- **设备管理**: Collector注册、状态监控、脚本下载
- **威胁监控**: 实时威胁事件展示和分析
- **系统监控**: 健康状态、性能指标、服务状态

#### 3. Auditd→Sysdig格式转换集成
- **实时转换**: Flink流处理实现
- **进程树重建**: 基于时间窗口的父进程查找
- **格式兼容**: 完全兼容sysdig格式
- **动态Topic**: 自动生成对应的输出Topic

### 🔄 进行中功能

#### 4. 前后端接口打通
- **API标准化**: 统一的REST API接口规范
- **接口文档**: 基于实际代码的API文档
- **服务集成**: Manager与各服务模块的接口集成
- **前端集成**: Web界面与后端API的完整集成

### 📋 v0.2 计划功能

#### 5. NODLINK/KnowHow服务化接入
- **模型服务**: NODLINK异常检测模型服务化
- **KnowHow集成**: 知识图谱和专家系统集成
- **机器学习**: 基于ML的高级威胁检测
- **智能分析**: 行为分析和异常检测

---

## 📊 性能指标

### 处理能力
- **数据吞吐**: 支持单台设备每秒1000条事件处理
- **延迟**: 毫秒级威胁检测响应
- **并发**: 支持100台设备同时接入
- **存储**: TB级历史数据存储和查询

### 资源要求（单台部署）
- **最小配置**: 4核8GB内存，50GB存储
- **操作系统**: Linux (Ubuntu 22.04+)

---

## 🔧 API接口

### 核心业务API
- **设备管理**: `/api/v1/collectors/*` - Collector注册、状态、元数据管理
- **安全事件**: `/api/v1/events/*` - 事件查询、威胁分析
- **系统监控**: `/api/v1/health/*` - 健康检查、Worker管理
- **脚本管理**: `/api/v1/scripts/*` - 安装/卸载脚本下载

### 服务管理API (services前缀)
- **Kafka管理**: `/api/v1/services/kafka/*` - 集群、Topic、消息管理
- **Flink管理**: `/api/v1/services/flink/*` - 作业、TaskManager管理
- **OpenSearch管理**: `/api/v1/services/opensearch/*` - 索引、搜索管理
- **Prometheus管理**: `/api/v1/services/prometheus/*` - 指标查询管理

### API设计特点
- **逻辑分层**: 业务API与服务管理API明确分离
- **统一规范**: 所有接口遵循RESTful设计原则
- **完整文档**: Swagger自动生成的API文档
- **认证支持**: API Key和Bearer Token双重认证

### 集成支持
- **Webhook**: 威胁事件推送
- **SIEM集成**: 标准化事件格式
- **API认证**: API Key和Bearer Token
- **批量操作**: 支持批量查询和操作

---

## 🚦 版本路线图

### v0.1 (当前版本) - 基础HIDS平台
**目标**: 提供完整的基础HIDS功能
- ✅ **代码合并整理**: Monorepo架构完成
- ✅ **核心EDR/HIDS功能**: 四大模块完整实现
- ✅ **Agentless数据采集**: 无代理部署支持
- ✅ **实时威胁检测**: 基于规则的威胁检测
- ✅ **Auditd→Sysdig转换**: 实时格式转换集成
- ✅ **前端页面实现**: 完整的Web管理界面
- 🔄 **前后端接口打通**: API标准化和前后端集成
- ✅ **基础API**: 完整的REST API接口

### v0.2 (下一版本) - EDR/智能化增强
**目标**: 集成机器学习和智能分析
- 📋 **Agent模式支持**: 有代理部署模式
- 📋 **NODLINK/KnowHow服务化**: 基于ML的威胁检测服务化
- 📋 **威胁情报集成**: 外部威胁情报源集成
- 📋 **可视化Dashboard优化**: 高级数据可视化

---

## 🎉 总结

SysArmor v0.1 提供了一个完整、现代化的HIDS解决方案，具备：

- **完整功能**: 从数据采集到威胁检测的全流程覆盖
- **高性能**: 基于流处理的实时检测能力
- **标准兼容**: 支持sysdig和NODLINK标准格式
- **易部署**: Docker化的一键部署
- **可扩展**: 微服务架构支持灵活扩展
- **开源**: 协议?
